/**
 * Created by shipeng on 5/14/2017.
 */
define("kg/xctrl/6.1.11/xctrl-kissy",["io","json"],function(require,exports,module){var io=require("io"),json=require("json"),kgXctrl6111SrcBaseApi,kgXctrl6111SrcGetHelper,kgXctrl6111SrcModBaseApiKissy,kgXctrl6111SrcApi,kgXctrl6111SrcBase,kgXctrl6111XctrlKissy;kgXctrl6111SrcBaseApi=function(t){"use strict";var e={};return e.isString=function(t){return"string"==typeof t&&t.constructor==String},e.isArray=function(t){return"object"==typeof t&&t.constructor==Array},e.isFunction=function(t){return"function"==typeof t&&t.constructor==Function},e.trim=function(t){for(var t=t.replace(/^\s+/,""),e=t.length-1;e>=0;e--)if(/\S/.test(t.charAt(e))){t=t.substring(0,e+1);break}return t},e.inArray=function(t,e,r){var a;if(e){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(e,t,r);for(a=e.length,r=r?0>r?Math.max(0,a+r):r:0;a>r;r++)if(r in e&&e[r]===t)return r}return-1},t=e}(),kgXctrl6111SrcGetHelper=function(t){"use strict";function e(t){r=window.XctrlBaseApi||{},this.init(t)}var r,a={request:{merge:{maxBlock:20,maxCount:80,maxTime:300,outTime:100},jsonp:{callback:"callback"},url:"",backupUrl:"",parameters:{},split:",;|"},response:{convert:{},path:""}};return e.prototype={init:function(t){var e=this;e.conf=r.merge(t,r.clone(a)),r.mix(e.conf,t,!0,null,!0),e.conf.request.merge&&e.conf.request.mergeKey&&(e._path=e.conf.request.mergeKey.split(">")),e._init()},_init:function(){var t=this;t._stack=[],t._resultSuccess={},t._block={},t._count=0,t._blockCount=0,t._startTime=null},_val:function(t,e){return e.replace(/\$\{([^}]*)\}/g,function(e,r){return t[r]||""})},_valResponse:function(t,e){return e.replace(/@\{([^}]*)\}/g,function(e,r){return t[r]})},countItem:function(){var t=this;return t.conf.request.mergeCount},_paraTr:function(t,e){var r=this,a={};for(var i in e)e.hasOwnProperty(i)&&(a[i]=r._val(t,e[i]));return a},push:function(t,e,a){var i,n,s=this,c=s.conf.request,o=c.merge,u=c.mergeKey,p=c.mergeCount,l=s._path,f=c.parameters,g={para:t,cb:e,dycfg:a||{}};if(i=s._paraTr(t,f),i=r.merge(i,t),n=a?o&&u&&a.merge:o&&u){s._startTime=s._startTime||new Date,p&&(""==i[p]?g.count="":g.count=parseInt(i[p],10),s._count+g.count>o.maxCount&&s._count>0&&s._do(),s._count+=g.count);for(var d=s._block,m=!1,h=0;h<l.length;h+=1){var y=i[l[h]];if(h+1===l.length)if(d[y]){for(var v=!1,_=0,k=d[y].length;k>_;_++)return d[y][_]===i[_]||(p?h===p:1)?!0:(v=!0,!1);if(v)return s._do(),s.push(t,e),s;p&&(d[y][p]+=i[p]?parseInt(i[p],10):"")}else{var b={};for(var A in i)i.hasOwnProperty(A)&&r.inArray(A,l)<0&&(p===A?b[A]=i[A]?parseInt(i[A],10):"":b[A]=i[A]);d[y]=b,m=!0}else d[y]||(d[y]={},m=!0),d=d[y]}if(s._stack.push(g),m&&(s._blockCount+=1,s._blockCount>=o.maxBlock))return s._do(),s;new Date-s._startTime>o.maxTime?s._do():(clearTimeout(s._timer),s._timer=setTimeout(function(){s._do()},o.outTime))}else s._stack.push(g),s._do(i),s._init(),clearTimeout(s._timer);return s},_getPara:function(){var t=this,e=t.conf.request,r=t._path,a=e.split.split(""),i=r.length,n=t._block,s=function(t,e,r){var n={};if(n[t[0]]=[],t.length>1){for(var c in e)if(e.hasOwnProperty(c)){n[t[0]].push(c);var o=s(t.slice(1),e[c],r+1);for(var u in o)o.hasOwnProperty(u)&&(n[u]||(n[u]=[]),n[u].push(o[u]))}}else{var p=0;for(var l in e){if(e.hasOwnProperty(l)){n[t[0]].push(l);var f=0;for(var g in e[l])e[l].hasOwnProperty(g)&&(n[g]||(n[g]=[]),n[g][p]=e[l][g],f++)}p++}for(var d in n)n[d].length!==p&&(n[d].length=p)}for(var m in n)n.hasOwnProperty(m)&&(n[m]=n[m].join(a[i-r-1]));return n};return s(r,n,0)},_do:function(t){var e=this,a=e._stack,i=r.JSON.stringify(t);e[i]=!1;var n,s=t||e._getPara(),c=e.conf.request.url,o=e.conf.request.backupUrl,u=function(r){e._assign(r,a,function(){o&&e._get(s,e.conf.request.backupUrl,u),e[i]=!0},t)};window.InitModeAjaxInTmsPreview&&(n=!0),a&&a[0]&&a[0].dycfg&&"mtop"===a[0].dycfg.mode&&!n&&r.MTop?e._mtopGet(s,c,u,function(){o&&e._get(s,e.conf.request.backupUrl,u,function(){}),e[i]=!0}):e._get(s,c,u,function(){o&&e._get(s,e.conf.request.backupUrl,u,function(){}),e[i]=!0}),e._init(),clearTimeout(e._timer)},_mtopGet:function(t,e,a,i){try{t.env&&t.env.indexOf("debug")>-1&&/\.alibaba-inc\./i.test(location.hostname)&&(lib.mtop.config.prefix="api.m",lib.mtop.config.subDomain="tms",lib.mtop.config.mainDomain="alibaba-inc.com");var n=r.clone(t);"kimi"===r.version&&(n.src="phone");var s=JSON.stringify(n);r.MTop.request({AntiCreep:!0,api:"mtop.taobao.tceget.xget",v:"1.0",data:{d:s},ecode:0,dataType:"jsonp",timeout:2e4},function(t){a&&a(t.data)},function(t){i&&i()})}catch(c){i&&i()}},_get:function(t,e,a,i){var n=this,s=(n.conf.request.jsonp.callback,function(t){var e=[];for(var r in t){var a=t[r];e.push(r+"="+a)}return e.join("&")});if(n.conf.request.cacheTime)var c=n._getCbName(t,e);else var c="jsonp"+r.guid();var o={};return"kimi"===r.version?o.src="phone":o.src="pc",r.sufei(function(){r.ajax({url:e+(e.indexOf("?")<0?"?":"&")+s(t),data:o,dataType:"jsonp",jsonpCallback:c,cache:!0,scriptCharset:"utf-8",timeout:n.conf.request.timeout,crossDomain:!0,success:function(t){a&&a(t)},error:function(){i&&i()}})}),n},_getCbName:function(t,e){var a=this,i="jsonp";try{i+=t.tce_sid.replace(/,/g,"");var n=e.indexOf("dispatch")>-1?"d":"n";i+=n;var s=a.conf.request.cacheTime;i+=parseInt(+new Date/s/1e3)}catch(c){i+=r.guid()}return i},_assign:function(t,e,a,i){var n,s,c,o,u,p,l=this,f=l.conf.response,g=f.convert,d=f.path.split("."),m=l.conf.request.backupUrl,h=(r.JSON.stringify(i),!1);if(g&&g.path){o=g.path.split("."),u=t;for(var y in o)u=u[o[y]];c={};for(var y in o){var v=o[y];c[l._valResponse(v,g.key)]=v}t=c}for(p=t.context.time||"",n=0;n<e.length;n+=1){for(c=t||[],s=0;s<d.length;s+=1)c=c[l._val(e[n].para,d[s])]||[];e[n].count&&(c=r.isArray(c)?c.splice(0,e[n].count):[]),r.isFunction(e[n].cb)&&(l[r.JSON.stringify(i)]?l._resultSuccess[r.JSON.stringify(e[n].para)]||(e[n].cb(c,p),l._resultSuccess[r.JSON.stringify(e[n].para)]="success"):(c.length>0&&!l._resultSuccess[r.JSON.stringify(e[n].para)]&&(e[n].cb(c,p),l._resultSuccess[r.JSON.stringify(e[n].para)]="success"),0===c.length&&e[n].dycfg.backup===!1&&(e[n].cb(c,p),l._resultSuccess[r.JSON.stringify(e[n].para)]="success"),0===c.length&&e[n].dycfg.backup&&(m?h=!0:(e[n].cb(c,p),l._resultSuccess[r.JSON.stringify(e[n].para)]="success"))))}h&&a&&a()}},t=e}(),kgXctrl6111SrcModBaseApiKissy=function(exports){"use strict";var version=KISSY&&KISSY.version,BaseApi=kgXctrl6111SrcBaseApi,LabApi,LabApi={merge:"KISSY.merge",mix:"KISSY.mix",guid:"KISSY.guid",clone:"KISSY.clone"};for(var key in LabApi)BaseApi[key]=eval(LabApi[key]);var IO=io,JSON=json;return BaseApi.JSON=JSON,BaseApi.ajax=function(t){return IO(t)},BaseApi.sufei=function(t){KISSY.getScript("//g.alicdn.com/sd/sufei/0.1.8/app/common/sufei-kissy.js",function(){t&&t()})},BaseApi.version="kissy",window.XctrlBaseApi=BaseApi,exports}(),kgXctrl6111SrcApi=function(t){"use strict";var e=kgXctrl6111SrcGetHelper,r={},a={add:function(t,a){return r[t]=new e(a),r[t]},use:function(t){return r[t]},GetHelper:e};return a.add("tcepre",{request:{timeout:5,url:"//tce.taobao.org/api/teg.htm",parameters:{tce_sid:"${tce_sid}",tce_vid:"${tce_vid}",env:"${env}",tid:"${tid}",tab:"${tab}",topic:"${topic}",count:"${count}"},charset:"utf-8"},response:{path:"result"}}),a.add("tceplus",{request:{timeout:5,url:"//tce.taobao.com/api/teg.htm",backupUrl:"//www.taobao.com/go/rgn/sys/xctrl/dispatch.php?murl=http://tce.taobao.com/api/teg.htm",parameters:{tce_sid:"${tce_sid}",tce_vid:"${tce_vid}",tid:"${tid}",tab:"${tab}",topic:"${topic}",count:"${count}"},charset:"utf-8"},response:{path:"result"}}),a.add("tcedaily",{request:{timeout:5,url:"//tce.daily.taobao.net/api/mget.htm",parameters:{tce_sid:"${tce_sid}",tce_vid:"${tce_vid}",tid:"${tid}",env:"${env}",tab:"${tab}",topic:"${topic}",count:"${count}"},mergeKey:"tce_sid",mergeCount:"count",charset:"utf-8"},response:{path:"result.${tce_sid}.result"}}),a.add("tceinner",{request:{timeout:5,url:"//tce.taobao.org/api/mget.htm",parameters:{tce_sid:"${tce_sid}",tce_vid:"${tce_vid}",tid:"${tid}",tab:"${tab}",env:"${env}",topic:"${topic}",count:"${count}"},charset:"utf-8"},response:{path:"result.${tce_sid}.result"}}),a.add("tceonline",{request:{timeout:5,url:"https://tce.taobao.com/api/mget.htm",backupUrl:"https://www.taobao.com/go/rgn/sys/xctrl/dispatch.php?murl=http://tce.taobao.com/api/mget.htm",parameters:{tce_sid:"${tce_sid}",tce_vid:"${tce_vid}",tid:"${tid}",tab:"${tab}",topic:"${topic}",count:"${count}"},mergeKey:"tce_sid",mergeCount:"count",charset:"utf-8"},response:{path:"result.${tce_sid}.result"}}),a.add("tcecdn",{request:{timeout:5,url:"//tce.alicdn.com/api/mget.htm",backupUrl:"//www.taobao.com/go/rgn/sys/xctrl/dispatch.php?murl=http://tce.alicdn.com/api/mget.htm",parameters:{tce_sid:"${tce_sid}",tce_vid:"${tce_vid}",tid:"${tid}",tab:"${tab}",topic:"${topic}",count:"${count}"},mergeKey:"tce_sid",mergeCount:"count",charset:"utf-8"},response:{path:"result.${tce_sid}.result"}}),a.add("tce",{request:{timeout:5,url:"//tce.taobao.com/api/get.htm",backupUrl:"//www.taobao.com/go/rgn/sys/xctrl/dispatch.php?murl=//tce.taobao.com/api/get.htm",parameters:{tce_sid:"${tce_sid}",tid:"${tid}",tab:"${tab}",topic:"${topic}",count:"${count}"},charset:"utf-8"},response:{path:"result"}}),t=a}(),kgXctrl6111SrcBase=function(exports){"use strict";function Multi(t){BaseApi=window.XctrlBaseApi||{},this.cfg=BaseApi.merge(defaultConfig,t),this.init(this.cfg)}var api=kgXctrl6111SrcApi,defaultConfig={timeout:3e3,extra:{},mode:"mtop",backup:!0,merge:!0},BaseApi;Multi.prototype={init:function(t){var e=this;e.cfg=t,e._stringfiyToResult(t)},_stringfiyToResult:function(conf){var self=this;if(window.JSON)var data=BaseApi.isString(conf.data)?JSON.parse(conf.data):conf.data;else var data=BaseApi.isString(conf.data)?eval("("+conf.data+")"):conf.data;var key=conf.key,cb=conf.callback,p=conf.extra;if(self.RequestFind=BaseApi.clone(data),BaseApi.isArray(key))if(0===key.length)cb(arr),self.log(key+" is undefiend");else{self.keyArrayResult={},self.keyArrayIndex=0,self.keyArrayLength=key.length;for(var i=0,len=key.length;len>i;i++){var sKey=key[i],sArr=data[key[i]];self._getData(sArr,sKey,cb,p)}}else if(BaseApi.isString(key)){var arr=data[key];arr&&BaseApi.isArray(arr)&&0!==arr.length?self._getData(arr,key,cb,p):(cb(arr),arr?""===arr?self.log("data['"+key+"'] has nothing"):self.log("data['"+key+"'] is not a array, tms coun't resolve it"):self.log(key+" is undefiend"))}},_getData:function(t,e,r,a){for(var i,n=this,s={},c=0,o=t.length;o>c;c++){var u,p,l=t[c],f=l.data_type,g=l.data_para,d=l.data_request;for(var m in l)BaseApi.isArray(l[m])&&(u=m,p=l[m]);if(g=d?n.checkRely(l):g,g=a?BaseApi.merge(g,a):g,f)if(i=api.use(f)){for(var h in g)if(g.hasOwnProperty(h)){try{g[h]=unescape(g[h])}catch(y){}g[h]=encodeURIComponent(BaseApi.trim(g[h]))}i.push(g,function(a,i){if(a&&BaseApi.isArray(a)&&0!==a.length)for(var a=n._GetMsgWhitCommit(a),c=0,o=a.length;o>c;c++){var l=a[c];d&&(l.data_request=d),u&&(p[0].data_request=l,l[u]=BaseApi.clone(p)),t[c]=l}else n.log(e+"\u8fd4\u56de\u6570\u636e\u4e3a\u7a7a"),t=[];n.keyArrayLength?(n.keyArrayResult[e]=t,n.keyArrayIndex++,n.keyArrayIndex===n.keyArrayLength&&(n.keyArrayResult.timestamp=i,n.keyArrayResult.isDynamic=!0,r&&r(n.keyArrayResult))):(s[e]=t,s.timestamp=i,s.isDynamic=!0,r&&r(s))},n.cfg)}else n.log(f,"api \u65e0\u6548");else{var v=BaseApi.clone(l);for(var m in l)if(BaseApi.isArray(l[m])){delete v[m];for(var h=0,_=l[m].length;_>h;h++){var k=l[m][h];k.data_request=v}}}}return 0!==t[0].length&&t[0].data_type||(s[e]=t,s.timestamp="",s.isDynamic=!1,r&&r(s)),!1},_toEachArr:function(t,e,r){var a=this;a.promise[e]={},a.promise[e].get=0,a.promise[e].len=t.length,a._postRequst(t,e,r)},_GetMsgWhitCommit:function(t){function e(t,e){for(var a,i=0,n=t.length;n>i;i++){var s=t[i],c=!0;for(var o in s)BaseApi.isString(s[o])&&e[o]!==s[o]&&(c=!1),BaseApi.isArray(s[o])&&(a=o);if(c){t=s[a];break}}if(!c)var t=r(t,e);return t}function r(t,e){for(var r,a=0,i=t.length;i>a;a++){var n=t[a],s=!1;for(var c in n)"cat_id"===c&&n[c]===e[c]&&(s=!0),BaseApi.isArray(n[c])&&(r=c);if(s){t=n[r];break}}return t}var a=this,i=BaseApi.clone(t),n=a.RequestFind;if(n.moduleinfo)return i;if(n.data_request){var s=n.data_request,c=e(i,s);i=e(c,n)}else i=e(i,n);return i},checkRely:function(t){var e=t.data_para;for(var r in e){var a=decodeURIComponent(e[r]),i=/@/g,n=a.match(i),s=n?n.length:0,c=null;if(s>0){for(var o=a.replace(i,""),u=0;s>u;u++)c=c?c.data_request:t.data_request;e[r]=c[o]}}return e},log:function(t){window.console&&console.log(t)}};var XCtrl;return XCtrl={dynamic:function(t,e,r,a){new Multi(arguments.length>1?{data:t,key:e,callback:r,extra:a}:arguments[0])}},exports=XCtrl}(),kgXctrl6111XctrlKissy=function(t){"use strict";var e=kgXctrl6111SrcBase;return t=e}(),module.exports=kgXctrl6111XctrlKissy});